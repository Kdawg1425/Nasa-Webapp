

{% extends "base.html" %}
{% block content %}

<!-- Top Banner -->
<div class="topcenter-container">
    <h2>Welcome, {{ username }}!</h2>
    <p>You are logged in. This is your workstation dashboard.</p>
</div>

<!-- Search bar -->
<div class="search-container">
    <form method="POST" action="{{ url_for('search') }}">
        <input type="text" name="search_name" placeholder="Search by name..." required>
        <button type="submit">Search</button>
    </form>
</div>

<!-- Add Quota Request Form -->
<div class="add-form">
    <form method="POST" action="{{ url_for('add_quota') }}">
        <input type="text" name="name" placeholder="Name" required>
        <input type="text" name="filesystem" placeholder="Filesystem" required>
        <input type="text" name="ticket_number" placeholder="Ticket Number" required>
        <input type="text" name="soft_quota" placeholder="Soft Quota (e.g. 10T or 600000)" required>
        <input type="text" name="hard_quota" placeholder="Hard Quota (e.g. 15T or 700000)" required>
        <label for="status">Status:</label>
        <select name="status" 
                hx-get="{{ url_for('toggle_expiration') }}"
                hx-target="#expiration-container"
                hx-trigger="change"
                hx-include="[name='status']"
                required>
            <option value="" selected disabled>-- Select Status --</option>
            <option value="permanent">Permanent</option>
            <option value="temporary">Temporary</option>
        </select>
        <div id="expiration-container">
            <!-- Empty on initial load-->
        </div>
        <button type="submit">Add Quota Request</button>
    </form>
</div>

<!-- Dashboard -->
<div class="dashboard-container">
    {% if results %}
        <div id="quota-table">
            <h3>Quota Requests for "{{ searched_name }}"</h3>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Filesystem</th>
                    <th>Ticket #</th>
                    <th>Soft Quota</th>
                    <th>Hard Quota</th>
                    <th>Status</th>
                    <th>Expiration Date</th>
                    <th>Date Created</th>
                    <th>Delete</th>
                </tr>
                {% for r in results %}
                <tr>
                    <td>{{ r[1] }}</td>
                    <td>{{ r[2] }}</td>
                    <td>{{ r[3] }}</td>
                    <td>{{ r[4] }}</td>
                    <td>{{ r[5] }}</td>
                    <td>{{ r[6] }}</td>
                    <td>{{ r[7] }}</td>
                    <td>{{ r[8] }}</td>
                    <td>
                        <form method="POST"
                              action="{{ url_for('delete_quota', quota_id=r[0]) }}"
                              hx-post="{{ url_for('delete_quota', quota_id=r[0]) }}"
                              hx-target="#quota-table"
                              hx-swap="outerHTML"
                              onsubmit="return confirm('Are you sure you want to delete this quota entry?');">
                            <button type="submit" style="background: none; border: none; cursor: pointer;">
                                üóëÔ∏è
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    {% elif searched_name %}
        <p>No results found for "{{ searched_name }}".</p>
    {% else %}
        <p>Search for a name to view quota request history.</p>
    {% endif %}
</div>

{% endblock %}
